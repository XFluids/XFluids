# XFLUIDS 配置选项说明手册 (Configuration Options Manual)

本手册分为三个部分：**全局构建选项**、**数值算法与物理模型选项**、以及**算例（Sample）专用配置**。

---

## 1. 编译与硬件架构选项 (Build & Hardware Options)

这些选项决定了项目使用哪种 SYCL 编译器以及针对哪种 GPU 架构进行优化。

| 选项名 | 可选值 | 描述 |
| :--- | :--- | :--- |
| `SYCL_COMPILE_SYSTEM` | `oneAPI`, `ACPP` | **核心选择**：使用 Intel oneAPI 还是 AdaptiveCpp (原 OpenSYCL) 编译系统。 |
| `SelectDv` | `host`, `cuda`, `hip`, `generic` | **后端选择**：<br>`host`: CPU 运行；<br>`cuda`: NVIDIA GPU (LLVM 后端)；<br>`hip`: AMD GPU (ROCm)；<br>`generic`: 通用 SSCP 后端。 |
| `ARCH` | 数字字符串 | **架构优化**：<br>NVIDIA: `75`, `80`, `86`, `90` (对应 sm_xx)；<br>AMD: `906`, `1030`, `1100` (对应 gfx_xxx)。 |
| `USE_MPI` | `ON`, `OFF` | 是否启用 MPI 并行支持。 |
| `AWARE_MPI` | `ON`, `OFF` | 是否启用 GPU-Aware MPI（直接在设备内存间传输数据）。 |
| `USE_DOUBLE` | `ON`, `OFF` | 精度选择：`ON` 为双精度（Double），`OFF` 为单精度（Float）。 |

---

## 2. 数值算法与物理模型选项 (Numerical & Physical Options)

这些选项控制求解器的数学离散化方式和物理过程的开启。

### 2.1 离散化与数值格式
| 选项名 | 可选值 | 描述 |
| :--- | :--- | :--- |
| `DISCRETIZATION_METHOD` | `FDM`, `FVM` | **离散化方法**：有限差分（FDM）或有限体积（FVM）。 |
| `WENO_ORDER` | `5`, `6`, `7` | WENO 格式阶数：5阶、6阶（WENOCU6）或7阶。 |
| `RIEMANN_SOLVER` | `HLLC`, `AUSM` | 黎曼求解器（主要用于 FVM）。 |
| `EIGEN_SYSTEM` | `positive-definite`, `overdetermined` | 特征系统类型（用于 FDM 方法中的通量分裂）。 |
| `ARTIFICIAL_VISC_TYPE` | `ROE`, `LLF`, `GLF` | **人工消散类型**：ROE、局部 Lax-Friedrichs 或全局 Lax-Friedrichs。 |

### 2.2 物理模型与热力学
| 选项名 | 可选值 | 描述 |
| :--- | :--- | :--- |
| `THERMAL` | `NASA`, `JANAF` | 热力学参数拟合标准。 |
| `Visc` | `ON`, `OFF` | 是否开启物理粘性通量。 |
| `Visc_Heat` | `ON`, `OFF` | 是否开启热传导项。 |
| `Visc_Diffu` | `ON`, `OFF` | 是否开启组分质量扩散项（需开启 `COP`）。 |
| `VISCOSITY_ORDER` | `Second`, `Fourth` | 粘性项离散阶数：2阶或4阶。 |
| `COP` | `ON`, `OFF` | 是否启用多组分（Multi-Component）模型。 |
| `ASYNC_SUBMIT` | `ON`, `OFF` | 是否开启异步任务提交模式。 |

---

## 3. 算例与混合物模型 (Sample & Mixture Selection)

通过设置 `INIT_SAMPLE` 和 `MIXTURE_MODEL`，CMake 会自动加载预设的物理参数。

### 3.1 典型算例预设 (INIT_SAMPLE)
| 算例名称 | 类型 | 自动触发的配置 (Auto-Flags) |
| :--- | :--- | :--- |
| `1d-insert-st` | 1D 激波管插入 | `COP=ON`, `Visc=OFF`, `COP_CHEME=OFF` |
| `1d-reactive-st` | 1D 反应激波管 | `COP=ON`, `COP_CHEME=ON` |
| `2d-riemann-shocks` | 2D 黎曼问题 | `COP=OFF`, `Visc=OFF`, `ARTIFICIAL_VISC_TYPE=GLF` |
| `2d-detonation` | 2D 爆轰波 | `COP=ON`, `POSITIVITY_PRESERVING=ON` |
| `shock-bubble` | 3D 激波泡交互 | `Visc=ON`, `Visc_Heat=ON`, `WENO_ORDER=6` |
| `read_grid/xxx` | 外部网格导入 | 自动从 `src/read_grid` 加载 Plot3D 格式网格 |

### 3.2 组分/混合物模型 (MIXTURE_MODEL)
对应的文件夹位于 `./runtime.dat/` 下，决定了计算中的化学组分。
*   **非反应流 (`NO-COP`)**: `Gamma=1.4`。
*   **多组分非反应流**: `1d-mc-insert-shock-tube`, `Insert-SBI`。
*   **反应流**:
    *   `Reaction/Insert-Air`: 惰性空气组分。
    *   `Reaction/H2O-N2_21_reaction`: 21步氢氧反应机理。
    *   `Reaction/RSBI-19REA`: 用于激波泡交互的反应机理。

---

## 4. 依赖逻辑与注意事项 (Dependency Logic)

在修改配置时，请注意以下逻辑依赖关系：

1.  **内存性能控制 (`EIGEN_ALLOC`)**:
    *   `OROC`: 逐行计算特征矩阵，节省寄存器（推荐用于组分数多的情况）。
    *   `RGIF`: 在内核中完全展开特征矩阵，消耗大量寄存器，组分数多时可能导致 `Register Spill` 降低性能。
2.  **粘性依赖**:
    *   若要使用质量扩散 (`Visc_Diffu`)，必须开启多组分开关 (`COP=ON`)。
    *   `Fourth` 阶粘性离散仅在 `DISCRETIZATION_METHOD=FDM` 时有效。
3.  **oneAPI 特有**:
    *   当选择 `oneAPI` 时，`BOOST_CXX` 会自动设为 `OFF`（优先使用标准库），且编译器强制锁定为 `clang++`。
4.  **路径警告**:
    *   如果系统未发现 `BOOST_ROOT`，CMake 将尝试运行脚本 `scripts/build_boost.sh` 自动在 `external` 目录下进行本地编译。

---
*XFLUIDS 配置文档 - v1.0*